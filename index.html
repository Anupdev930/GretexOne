<!DOCTYPE html>
<html>
<head>
Â  <base target="_top">
  <title>Gretex One - Login</title>
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â Â <link rel="stylesheet" href="style.css">
Â  
</head>

<body>
Â  <div id="main-content">
Â  Â  <div id="login-container">
Â  Â  Â  <div class="login-panel-left">
Â  Â  Â  Â  <h1>Gretex One</h1>
Â  Â  Â  Â  <p>A secure space to manage all your applications and tasks effortlessly. Sign in to access your personalized dashboard.</p>
Â  Â  Â  </div>
Â  Â  Â  <div class="login-panel-right">
Â  Â  Â  Â  <h2>Welcome Back <span>ðŸ‘‹</span></h2>
Â  Â  Â  Â  <p>Please sign in to your account.</p>
Â  Â  Â  Â  <form id="login-form">
Â  Â  Â  Â  Â  <label for="userid">User ID</label>
Â  Â  Â  Â  Â  <input type="text" id="userid" name="userid" required>
Â  Â  Â  Â  Â  <label for="password">Password</label>
Â  Â  Â  Â  Â  <input type="password" id="password" name="password" required>
Â  Â  Â  Â  Â  <div id="message"></div>
Â  Â  Â  Â  Â  <button type="submit" id="login-button">Sign In</button>
Â  Â  Â  Â  Â  <a href="#" class="forgot-password">Forgot Password?</a>
Â  Â  Â  Â  </form>
Â  Â  Â  </div>
Â  Â  </div>
  </div> 
  
  <script>
    // ******* IMPORTANT *******
    // PASTE YOUR NEW APPS SCRIPT WEB APP URL HERE
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzJ509n_LiOwk6OUDckqIpsrH8tQWIZacpR5tpB1XYjRv6UjKAZYx2roFN8Q1clZd8Dqw/exec"; 
    // *************************

Â  Â  document.addEventListener("DOMContentLoaded", function() {
Â  Â  Â  const loginForm = document.getElementById("login-form");
      
      // Check if user is already logged in
      if (sessionStorage.getItem("gretexUser")) {
        window.location.href = "App_access.html"; // Redirect to dashboard
      }
Â  Â  Â Â 
Â  Â  Â  loginForm.addEventListener("submit", function(e) {
Â  Â  Â  Â  e.preventDefault(); 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const loginButton = document.getElementById("login-button");
Â  Â  Â  Â  const messageDiv = document.getElementById("message");
Â  Â  Â  Â Â 
Â  Â  Â  Â  messageDiv.innerHTML = "Signing in...";
Â  Â  Â  Â  messageDiv.className = "loading-message";
Â  Â  Â  Â  loginButton.disabled = true;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Get data from the form
Â  Â  Â  Â  const credentials = {
Â  Â  Â  Â  Â  userId: document.getElementById("userid").value,
Â  Â  Â  Â  Â  password: document.getElementById("password").value
Â  Â  Â  Â  };
        
        // This is the data we will send to the API
        const requestData = {
          action: "userLogin",
          params: credentials
        };

        // ** NEW: Send data using fetch() **
Â  Â  Â  Â  fetch(SCRIPT_URL, {
          method: 'POST',
          // Note: Using 'text/plain' is a common workaround for simple Apps Script POSTs
          headers: { 'Content-Type': 'text/plain;charset=utf-8' }, 
          body: JSON.stringify(requestData)
        })
        .then(res => res.json()) // Parse the JSON response from Apps Script
        .then(response => {
          // This is our new "onLoginSuccess" logic
          if (response.status === "success") {
            // 1. Save user data to session
Â  Â  Â  Â  Â  Â  sessionStorage.setItem("gretexUser", JSON.stringify(response.data));
Â  Â  Â  Â  Â  Â  
            // 2. Redirect to the dashboard FILE
Â  Â  Â  Â  Â  Â  window.location.href = "App_access.html";
          } else {
            // Show the error message from the API
            messageDiv.innerHTML = response.data.message;
            messageDiv.className = "error-message";
            loginButton.disabled = false;
          }
        })
        .catch(error => {
          // This is our new "onLoginFailure" logic
          console.error("Fetch Error:", error);
          messageDiv.innerHTML = "Error: " + error.message;
          messageDiv.className = "error-message";
          loginButton.disabled = false;
        });
Â  Â  Â  }); 
Â  Â  });
Â  </script>

</body>
</html>
